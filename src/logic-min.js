"use strict";const previousScreen=document.querySelector("#p_screen"),currentScreen=document.querySelector("#c_screen"),numbers=document.querySelectorAll("[data-number]"),operators=document.querySelectorAll("[data-operator], [data-percentage]"),parenthesis=document.querySelector("[data-parenthesis]"),clearAllBtn=document.querySelector("[data-clearAll]"),deleteBtn=document.querySelector("[data-delete]"),equalBtn=document.querySelector("[data-equal]"),operatorsCheck={"×":"×","+":"+","-":"-","%":"%","÷":"÷"},appendOperatorCheck={"*":"×","+":"+","-":"-","%":"%","/":"÷"};let preZeroAddedString,postZeroAddedString,validationArray=[],openParenthesisCount=0,operatorTracker=[],initializer=!1,finalClicked=!1;class Calculator{constructor(e,t,r,n,a){this.prevScreen=e,this.crntScreen=t,this.transitionTrigger=r,this.maximumCount=n,this.elementCount=a,this.clearAll()}clearAll(){this.prevText="0",this.currentText="0",this.maximumCount=[],this.transitionTrigger=[],this.crntScreen.classList.replace("text-2xl","text-4xl"),this.crntScreen.classList.replace("sm:text-2xl","sm:text-4xl"),this.crntScreen.style.color="rgb(203 203 203)",this.prevScreen.style.color="",operatorTracker=[],validationArray=[],postZeroAddedString="",openParenthesisCount=0,document.querySelector("#invalid").classList.remove("invalidOpacity"),finalClicked=!1,previousScreen.textContent="0"}delete(){this.currentText=this.currentText.slice(0,-1),this.transitionTrigger.pop(),this.maximumCount.pop(),operatorTracker.pop(),this.currentText.length<1&&(this.currentText="0",operatorTracker=[],validationArray=[],this.maximumCount=[],openParenthesisCount=0,finalClicked=!1,document.querySelector("#invalid").classList.remove("invalidOpacity")),this.transitionTrigger.length<=10&&(this.crntScreen.classList.replace("text-2xl","text-4xl"),this.crntScreen.classList.replace("sm:text-2xl","sm:text-4xl"))}appendNumber(e){finalClicked&&(this.currentText="",this.maximumCount=[],this.transitionTrigger=[],finalClicked=!1);const{transitionTrigger:t,crntScreen:r,maximumCount:n}=this;operatorTracker=[],t.length>=10&&(r.classList.replace("text-4xl","text-2xl"),r.classList.replace("sm:text-4xl","sm:text-2xl")),n.length>=15||("0"===this.currentText&&(this.currentText=""),this.currentText=this.currentText.toString()+e.toString(),"."===validationArray[0]&&(validationArray.unshift("0"),preZeroAddedString=`${this.currentText.slice(0,-1)}0${this.currentText.slice(-1)}`,this.currentText=preZeroAddedString))}appendOperation(e){operatorTracker.length>1?this.currentText=this.currentText.slice(0,-1)+e[0]:(this.maximumCount=[],finalClicked?(this.currentText=this.crntScreen.textContent+e,this.transitionTrigger=[],finalClicked=!1):this.currentText=initializer?postZeroAddedString:this.currentText.toString()+e.toString(),initializer=!1)}addParenthesis(e){this.currentText=this.currentText+e,this.transitionTrigger.push(e),this.transitionTrigger.length>=10&&(this.crntScreen.classList.replace("text-4xl","text-2xl"),this.crntScreen.classList.replace("sm:text-4xl","sm:text-2xl"))}updateDisplay(){this.crntScreen.innerHTML=formatCalculatorScreen(this.currentText)}evaluateValue(e){this.crntScreen.innerHTML=e}updateEntries(e){this.maximumCount.length>=15||(this.transitionTrigger.push(e),this.maximumCount.push(e))}}const calculator=new Calculator(previousScreen,currentScreen,[],[],0),numberAppender=e=>{if(!validationArray.includes(".")||"."!==e.children[0].innerText){for(let e in operatorsCheck)validationArray.includes(operatorsCheck[e])&&(validationArray=[]);"%"===currentScreen.textContent.slice(-1)?(calculator.appendNumber(`×${e.children[0].innerText}`),calculator.updateDisplay(),calculator.updateEntries(e.children[0].innerText)):(validationArray.push(e.children[0].innerText),calculator.appendNumber(e.children[0].innerText),calculator.updateDisplay(),calculator.updateEntries(e.children[0].innerText))}};function formatCalculatorScreen(e){return e.replace(/(\d+(\.\d+)?|[-+×÷%()]?|)/g,function(e){if(/[0-9.]/.test(e)){if(e.includes(".")){let t=e.split(".");return t[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")+(t[1]?"."+t[1]:"")}return e.replace(/\B(?=(\d{3})+(?!\d))/g,",")}return'<span class="operator">'+e+"</span>"})}function vibrationOnClick(){"vibrate"in navigator?navigator.vibrate([40,5]):console.log("Vibration not Supported")}function evaluateExpression(e){const t={"+":1,"-":1,"×":2,"÷":2,"%":2,"(":0},r=[],n=[0];function a(){const e=r.pop(),t=n.pop(),a=n.pop();switch(e){case"+":n.push(a+t);break;case"-":n.push(a-t);break;case"×":n.push(a*t);break;case"÷":n.push(a/t);break;case"%":n.push(t/100)}}const c=e.match(/\d+(\.\d+)?|\+|\-|\×|\÷|\%|\(|\)/g);for(const e of c)if(isNaN(e))if("("===e)r.push(e);else if(")"===e){for(;r.length&&"("!==r[r.length-1];)a();r.pop()}else{for(;r.length&&t[r[r.length-1]]>=t[e];)a();r.push(e)}else n.push(parseFloat(e));for(;r.length;)a();return n.pop()}operators.forEach(e=>{e.addEventListener("click",()=>{if(vibrationOnClick(),"0"!==currentScreen.textContent){if("("===currentScreen.textContent.slice(-1)&&"%"===e.children[0].innerText)return document.querySelector("#invalid").classList.remove("invalidOpacity"),void document.querySelector("#invalid").classList.add("invalidOpacity");if(!/[-+×÷%]/.test(currentScreen.textContent.slice(-1))){if(console.log(currentScreen.textContent),"."===validationArray[validationArray.length-1]&&(postZeroAddedString=`${currentScreen.innerText.slice(0)}0${e.children[0].innerText}`,console.log(postZeroAddedString),initializer=!0),"("===currentScreen.textContent.slice(-1)&&/[×÷%]/.test(e.children[0].innerText))return document.querySelector("#invalid").classList.replace("hidden","block"),void document.querySelector("#invalid").classList.add("invalidOpacity");validationArray.length&&!validationArray.includes(e.children[0].innerText)&&(validationArray=[]),operatorTracker.push(e.children[0].innerText),validationArray.push(e.children[0].innerText),calculator.appendOperation(e.children[0].innerText),calculator.updateDisplay()}}else document.querySelector("#invalid").classList.add("invalidOpacity")})}),clearAllBtn.addEventListener("click",()=>{calculator.clearAll(),calculator.updateDisplay()}),deleteBtn.addEventListener("click",()=>{calculator.delete(),calculator.updateDisplay();const e=evaluateExpression(currentScreen.textContent.replace(/\b(\d{1,3}(,\d{3})*(\.\d+)?)\b/g,function(e,t){return t.replace(/,/g,"")}));e?(previousScreen.classList.replace("opacity-0","opacity-100"),previousScreen.innerHTML=e):previousScreen.classList.add("opacity-0"),"-×÷".includes(currentScreen.textContent.slice(-1))&&previousScreen.classList.replace("opacity-100","opacity-0")}),parenthesis.addEventListener("click",()=>{if(vibrationOnClick(),currentScreen.textContent.includes("(")&&/[0-9)]/.test(currentScreen.textContent.slice(-1))){if(!openParenthesisCount)return;calculator.addParenthesis(")"),calculator.updateDisplay(),openParenthesisCount--}operatorTracker=[],/[-+×÷%]/.test(currentScreen.textContent.slice(-1))&&(calculator.addParenthesis("("),calculator.updateDisplay(),openParenthesisCount++),/[0-9]/.test(currentScreen.textContent.slice(-1))&&(calculator.addParenthesis("×("),calculator.updateDisplay(),openParenthesisCount++),currentScreen.textContent.includes("(")&&/[-+×÷%]/.test(currentScreen.textContent.slice(-1))&&(calculator.addParenthesis("("),calculator.updateDisplay(),openParenthesisCount++)}),document.getElementById("imageDisable").addEventListener("contextmenu",e=>{e.preventDefault()}),window.addEventListener("keydown",e=>{e.key.toLowerCase()==="Backspace".toLowerCase()&&(calculator.delete(),calculator.updateDisplay())}),window.addEventListener("keypress",e=>{if(!isNaN(parseInt(e.key))||"."===e.key){if(validationArray.includes(".")&&"."===e.key)return;for(let e in operatorsCheck)validationArray.includes(operatorsCheck[e])&&(validationArray=[]);"%"===currentScreen.textContent.slice(-1)?(calculator.appendNumber(`×${e.key}`),calculator.updateDisplay(),calculator.updateEntries(e.key)):(validationArray.push(e.key),calculator.appendNumber(e.key),calculator.updateDisplay(),calculator.updateEntries(e.key))}if("("===e.key||")"===e.key){if(currentScreen.textContent.includes("(")&&/[0-9)]/.test(currentScreen.textContent.slice(-1))){if(!openParenthesisCount)return;calculator.addParenthesis(")"),calculator.updateDisplay(),openParenthesisCount--}operatorTracker=[],/[-+×÷%]/.test(currentScreen.textContent.slice(-1))&&(calculator.addParenthesis("("),calculator.updateDisplay(),openParenthesisCount++),/[0-9]/.test(currentScreen.textContent.slice(-1))&&(calculator.addParenthesis("×("),calculator.updateDisplay(),openParenthesisCount++),currentScreen.textContent.includes("(")&&/[-+×÷%]/.test(currentScreen.textContent.slice(-1))&&(calculator.addParenthesis("("),calculator.updateDisplay(),openParenthesisCount++)}for(let t in appendOperatorCheck){if(e.key===t){if(/[-+×÷%]/.test(currentScreen.textContent.slice(-1)))return;"."===validationArray[validationArray.length-1]&&(postZeroAddedString=`${currentScreen.innerText.slice(0)}0${appendOperatorCheck[t]}`,console.log(postZeroAddedString),initializer=!0),validationArray.length&&!validationArray.includes(appendOperatorCheck[t])&&(validationArray=[]),operatorTracker.push(appendOperatorCheck[t]),validationArray.push(appendOperatorCheck[t]),calculator.appendOperation(appendOperatorCheck[t]),calculator.updateDisplay()}"("===currentScreen.textContent.slice(-1)&&"%"===e.key&&(document.querySelector("#invalid").classList.remove("invalidOpacity"),document.querySelector("#invalid").classList.add("invalidOpacity"))}if(!isNaN(e.key)||e.key==="-+×÷%".includes(e.key)){const e=/\b(\d{1,3}(,\d{3})*(\.\d+)?)\b/g;const t=evaluateExpression(currentScreen.textContent.replace(e,function(e,t){return t.replace(/,/g,"")}));t?(previousScreen.classList.replace("opacity-0","opacity-100"),previousScreen.innerHTML=t):previousScreen.classList.add("opacity-0")}});const allElems=document.querySelectorAll("[data-operator], [data-number], [data-percentage], [data-parenthesis]");allElems.forEach(e=>{e.addEventListener("click",()=>{currentScreen.style.color="rgb(203 203 203)";const e=evaluateExpression(currentScreen.textContent.replace(/\b(\d{1,3}(,\d{3})*(\.\d+)?)\b/g,function(e,t){return t.replace(/,/g,"")}));console.log(e),isNaN(e)&&0!==e?isNaN(e)&&(previousScreen.classList.add("opacity-0"),previousScreen.textContent="0",previousScreen.classList.replace("opacity-100","opacity-0")):(previousScreen.classList.replace("opacity-0","opacity-100"),previousScreen.innerHTML=e),"-×÷".includes(currentScreen.textContent.slice(-1))&&(console.log("Hey"),previousScreen.classList.replace("opacity-100","opacity-0")||previousScreen.classList.add("opacity-0"))})});const finalAnswerDisplay=()=>{"+-%×÷".includes(currentScreen.textContent.slice(-1))||(""===previousScreen.textContent&&"0"!==previousScreen.textContent||(currentScreen.classList.replace("opacity-100","opacity-0"),previousScreen.classList.add("upAnimate"),currentScreen.style.color="rgb(67 214 54)",previousScreen.classList.replace("text-2xl","text-4xl"),currentScreen.textContent=previousScreen.textContent,previousScreen.addEventListener("transitionend",()=>{previousScreen.classList.remove("upAnimate"),previousScreen.classList.replace("text-4xl","text-2xl"),previousScreen.textContent="0",previousScreen.classList.replace("opacity-100","opacity-0"),currentScreen.classList.replace("opacity-0","opacity-100")})),finalClicked=!0)};equalBtn.addEventListener("click",()=>{vibrationOnClick(),"+-%×÷".includes(currentScreen.textContent.slice(-1))||(""===previousScreen.textContent&&"0"!==previousScreen.textContent||(currentScreen.classList.replace("opacity-100","opacity-0"),previousScreen.classList.add("upAnimate"),currentScreen.style.color="rgb(67 214 54)",previousScreen.classList.replace("text-2xl","text-4xl"),currentScreen.textContent=previousScreen.textContent,previousScreen.addEventListener("transitionend",()=>{previousScreen.classList.remove("upAnimate"),previousScreen.classList.replace("text-4xl","text-2xl"),previousScreen.textContent="0",previousScreen.classList.replace("opacity-100","opacity-0"),currentScreen.classList.replace("opacity-0","opacity-100")})),finalClicked=!0)}),numbers.forEach(e=>{e.addEventListener("click",()=>{e.children[0].classList.add("numberTextScaleAnimation")})}),operators.forEach(e=>{e.addEventListener("click",t=>{e.children[0].classList.add("operatorTextScaleAnimation")})}),numbers.forEach(e=>{e.addEventListener("touchstart",t=>{e.style.backgroundColor="#444444"})}),numbers.forEach(e=>{e.addEventListener("touchend",t=>{e.children[0].classList.remove("numberTextScaleAnimation"),e.style.backgroundColor="#1a1a1a"})}),operators.forEach(e=>{e.addEventListener("touchstart",t=>{e.style.backgroundColor="#1a1a1a"})}),operators.forEach(e=>{e.addEventListener("touchend",t=>{e.children[0].classList.remove("operatorTextScaleAnimation"),e.style.backgroundColor="#303030"})}),clearAllBtn.addEventListener("click",e=>{clearAllBtn.children[0].classList.add("numberTextScaleAnimation")}),clearAllBtn.addEventListener("touchstart",e=>{clearAllBtn.style.backgroundColor="#1a1a1a"}),clearAllBtn.addEventListener("touchend",e=>{clearAllBtn.children[0].classList.remove("numberTextScaleAnimation"),clearAllBtn.style.backgroundColor="#303030"});